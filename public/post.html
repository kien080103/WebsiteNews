<!DOCTYPE html>
<html lang="vi">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Chi ti·∫øt b√†i vi·∫øt - BlogNews</title>
    <meta name="description" content="ƒê·ªçc chi ti·∫øt b√†i vi·∫øt v·ªÅ du l·ªãch tr√™n BlogTravel.">
    <meta property="og:title" content="Chi ti·∫øt b√†i vi·∫øt - BlogTravel">
    <meta property="og:description" content="ƒê·ªçc chi ti·∫øt b√†i vi·∫øt v·ªÅ du l·ªãch tr√™n BlogTravel.">
    <meta property="og:image" content="">
    <meta property="og:url" content="">
    <link rel="stylesheet" href="/style.css">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap" rel="stylesheet">
    <script src="https://unpkg.com/@tailwindcss/browser@latest"></script>
</head>

<body class="bg-gray-100 font-inter">
    <header class="bg-white shadow-md py-4">
        <div class="container mx-auto flex items-center justify-between px-4">
            <div class="logo text-xl font-bold text-gray-800"><a href="/" style="text-decoration:none;color:red">üåê
                    BlogNews</a></div>
            <nav>
                <input type="text"
                    class="search px-4 py-2 rounded-full border border-gray-300 focus:outline-none focus:ring-2 focus:ring-indigo-500"
                    placeholder="T√¨m ki·∫øm...">
            </nav>
        </div>
    </header>

    <main class="container mx-auto py-8 grid grid-cols-1 lg:grid-cols-3 gap-8 px-4">
        <div class="main-content lg:col-span-2 bg-white rounded-lg shadow-md p-6">
            <article id="post-detail">
                <h1 id="post-title" class="text-3xl font-bold text-gray-900 mb-4">ƒêang t·∫£i...</h1>
                <img id="post-image" src="" alt="" class="w-full rounded-lg mb-6 object-cover"
                    style="max-height: 400px;">
                <div id="post-content" class="text-gray-700 leading-relaxed prose lg:prose-lg">
                </div>
            </article>
            <section id="author-comment" class="mt-10 bg-gray-50 p-6 rounded-lg border border-gray-200 shadow-sm">
                <!-- S·ªë l∆∞·ª£ng b√¨nh lu·∫≠n -->
<h3 class="text-lg font-semibold mt-8 mb-2">
  üí¨ <span id="comment-count">0</span> b√¨nh lu·∫≠n
</h3>

<!-- Danh s√°ch b√¨nh lu·∫≠n -->
<ul id="comment-list" class="space-y-4 mb-6"></ul>

<!-- Form g·ª≠i b√¨nh lu·∫≠n -->
<div class="mt-6">
  <textarea id="new-comment-content" rows="3" placeholder="Nh·∫≠p b√¨nh lu·∫≠n c·ªßa b·∫°n..."
    class="w-full p-3 border border-gray-300 rounded-md resize-none"></textarea>
  <button id="submit-comment" class="mt-2 px-4 py-2 bg-blue-600 text-white rounded hover:bg-blue-700">
    G·ª≠i b√¨nh lu·∫≠n
  </button>
</div>
            </section>
        </div>

        <aside class="sidebar-right lg:col-span-1 bg-white rounded-lg shadow-md p-6">
            <h3 class="text-lg font-semibold text-gray-800 mb-4">B√†i vi·∫øt kh√°c</h3>
            <ul id="related-posts" class="list-none p-0">
            </ul>
        </aside>
    </main>

    <footer class="bg-gray-100 py-8 text-gray-600 text-sm">
        <div class="container mx-auto px-4 grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6">
            <div>
                <h6 class="font-semibold text-gray-800 mb-3">Chuy√™n m·ª•c</h6>
                <ul class="list-none p-0">
                    <li class="mb-2"><a href="#" class="hover:text-indigo-600">ƒê·ªùi s·ªëng</a></li>
                    <li class="mb-2"><a href="#" class="hover:text-indigo-600">Du l·ªãch</a></li>
                    <li class="mb-2"><a href="#" class="hover:text-indigo-600">VƒÉn h√≥a</a></li>
                    <li class="mb-2"><a href="#" class="hover:text-indigo-600">·∫®m th·ª±c</a></li>
                    <li class="mb-2"><a href="#" class="hover:text-indigo-600">G√≥c nh√¨n</a></li>
                </ul>
            </div>
            <div>
                <h6 class="font-semibold text-gray-800 mb-3">Th√¥ng tin</h6>
                <ul class="list-none p-0">
                    <li class="mb-2"><a href="/about" class="hover:text-indigo-600">V·ªÅ ch√∫ng t√¥i</a></li>
                    <li class="mb-2"><a href="/contact" class="hover:text-indigo-600">Li√™n h·ªá</a></li>
                    <li class="mb-2"><a href="/privacy" class="hover:text-indigo-600">Ch√≠nh s√°ch b·∫£o m·∫≠t</a></li>
                    <li class="mb-2"><a href="/terms" class="hover:text-indigo-600">ƒêi·ªÅu kho·∫£n s·ª≠ d·ª•ng</a></li>
                    <li class="mb-2"><a href="/sitemap" class="hover:text-indigo-600">Sitemap</a></li>
                </ul>
            </div>
            <div>
                <h6 class="font-semibold text-gray-800 mb-3">M·∫°ng x√£ h·ªôi</h6>
                <ul class="list-none p-0">
                    <li class="mb-2"><a href="www.facebook.com/kienvn2003" class="hover:text-indigo-600">Facebook</a>
                    </li>
                    <li class="mb-2"><a href="#" class="hover:text-indigo-600">Twitter</a></li>
                    <li class="mb-2"><a href="#" class="hover:text-indigo-600">Instagram</a></li>
                    <li class="mb-2"><a href="#" class="hover:text-indigo-600">YouTube</a></li>
                    <li class="mb-2"><a href="#" class="hover:text-indigo-600">RSS</a></li>
                </ul>
            </div>
            <div>
                <h6 class="font-semibold text-gray-800 mb-3">Li√™n h·ªá</h6>
                <p class="mb-2">ƒê·ªãa ch·ªâ: 6 V√µ Th·ªã S√°u, Ph∆∞·ªùng B·∫øn Th·ªßy, Th√†nh Ph·ªë Vinh</p>
                <p class="mb-2">Email: kienvn2k3@gmail.com</p>
                <p class="mb-2">Hotline: 0327 062 858</p>
            </div>
        </div>
        <div class="container mx-auto px-4 mt-6 border-t border-gray-200 py-4 text-center text-gray-500 text-xs">
            &copy; 2025 BlogNews. All rights reserved.
        </div>
    </footer>


    <script>
        const urlParams = new URLSearchParams(window.location.search);
        const id = urlParams.get('id');
        const postTitleElement = document.getElementById('post-title');
        const postImageElement = document.getElementById('post-image');
        const postContentElement = document.getElementById('post-content');
        const relatedPostsList = document.getElementById('related-posts');

        fetch(`/api/posts/${id}`)
            .then(res => res.json())
            .then(post => {
                postTitleElement.textContent = post.title || 'Kh√¥ng c√≥ ti√™u ƒë·ªÅ';
                postImageElement.src = post.featuredImage || 'https://via.placeholder.com/600x300';
                postImageElement.alt = post.title || '·∫¢nh b√†i vi·∫øt';
                postContentElement.innerHTML = post.content || 'N·ªôi dung ƒëang ƒë∆∞·ª£c c·∫≠p nh·∫≠t.';
                document.title = `${post.title} - BlogTravel`; // C·∫≠p nh·∫≠t title trang
                document.querySelector('meta[property="og:title"]').content = post.title;
                document.querySelector('meta[property="og:image"]').content = post.featuredImage || 'https://via.placeholder.com/600x300';
                document.querySelector('meta[property="og:url"]').content = window.location.href;
                document.querySelector('meta[name="description"]').content = post.content ? post.content.substring(0, 160) + '...' : 'ƒê·ªçc chi ti·∫øt b√†i vi·∫øt v·ªÅ du l·ªãch tr√™n BlogTravel.';
                document.querySelector('meta[property="og:description"]').content = post.content ? post.content.substring(0, 160) + '...' : 'ƒê·ªçc chi ti·∫øt b√†i vi·∫øt v·ªÅ du l·ªãch tr√™n BlogTravel.';
            })
            .catch(error => {
                console.error('L·ªói khi t·∫£i chi ti·∫øt b√†i vi·∫øt:', error);
                postTitleElement.textContent = 'Kh√¥ng th·ªÉ t·∫£i b√†i vi·∫øt.';
                postContentElement.textContent = 'ƒê√£ c√≥ l·ªói x·∫£y ra khi t·∫£i n·ªôi dung.';
            });

        fetch('/api/posts')
            .then(res => res.json())
            .then(posts => {
                const relatedPosts = posts.filter(p => p._id !== id).slice(0, 5);
                if (relatedPosts.length > 0) {
                    relatedPosts.forEach(p => {
                        const listItem = document.createElement('li');
                        listItem.className = 'mb-2';
                        const link = document.createElement('a');
                        link.href = `/post.html?id=${p._id}`;
                        link.textContent = p.title || 'B√†i vi·∫øt li√™n quan';
                        link.className = 'text-indigo-600 hover:text-indigo-800 font-medium';
                        listItem.appendChild(link);
                        relatedPostsList.appendChild(listItem);
                    });
                } else {
                    const listItem = document.createElement('li');
                    listItem.textContent = 'Kh√¥ng c√≥ b√†i vi·∫øt li√™n quan.';
                    relatedPostsList.appendChild(listItem);
                }
            })
            .catch(error => {
                console.error('L·ªói khi t·∫£i b√†i vi·∫øt li√™n quan:', error);
                const listItem = document.createElement('li');
                listItem.textContent = 'L·ªói khi t·∫£i b√†i vi·∫øt li√™n quan.';
                relatedPostsList.appendChild(listItem);
            });
        // T·∫£i ph·∫ßn b√¨nh lu·∫≠n c·ªßa t√°c gi·∫£
let postId;

// L·∫•y ID b√†i vi·∫øt t·ª´ URL

if (urlParams.has('id')) {
    postId = urlParams.get('id');
} else {
    const pathSegments = window.location.pathname.split('/');
    postId = pathSegments.filter(Boolean).pop(); // L·∫•y ƒëo·∫°n cu·ªëi kh√¥ng r·ªóng
}

if (!postId) {
    console.error('Kh√¥ng th·ªÉ x√°c ƒë·ªãnh ID b√†i vi·∫øt t·ª´ URL.');
} else {
    console.log('ID b√†i vi·∫øt:', postId);
    loadComments(); // Ch·ªâ t·∫£i n·∫øu c√≥ postId
}

// H√†m t·∫£i b√¨nh lu·∫≠n
async function loadComments() {
    try {
        const res = await fetch(`/api/comments/post/${postId}`);
        if (!res.ok) throw new Error(`L·ªói HTTP: ${res.status}`);

        const comments = await res.json();

        // C·∫≠p nh·∫≠t s·ªë l∆∞·ª£ng
        document.getElementById('comment-count').textContent = comments.length;

        const commentList = document.getElementById('comment-list');
        commentList.innerHTML = ''; // X√≥a c≈©

        comments.forEach(cmt => {
            const li = document.createElement('li');
            li.className = 'p-4 bg-white border border-gray-200 rounded-md mb-2';

            const author = cmt.userId?.username || '[·∫®n danh]';

            li.innerHTML = `
                <div class="text-sm font-semibold text-gray-800 mb-1">${author}</div>
                <p class="text-gray-700">${cmt.content}</p>
            `;
            commentList.appendChild(li);
        });

    } catch (error) {
        console.error('L·ªói khi t·∫£i b√¨nh lu·∫≠n:', error);
        alert('Kh√¥ng th·ªÉ t·∫£i b√¨nh lu·∫≠n. Vui l√≤ng th·ª≠ l·∫°i sau.');
    }
}

// Ki·ªÉm tra tr·∫°ng th√°i ƒëƒÉng nh·∫≠p khi t·∫£i trang
document.addEventListener('DOMContentLoaded', () => {
    const token = localStorage.getItem('token');
    const submitButton = document.getElementById('submit-comment');
    const commentInput = document.getElementById('new-comment-content');

    if (!token) {
        // N·∫øu ch∆∞a ƒëƒÉng nh·∫≠p, ·∫©n n√∫t g·ª≠i b√¨nh lu·∫≠n v√† hi·ªÉn th·ªã th√¥ng b√°o
        submitButton.disabled = true;
        commentInput.placeholder = 'B·∫°n c·∫ßn ƒëƒÉng nh·∫≠p ƒë·ªÉ g·ª≠i b√¨nh lu·∫≠n.';
        commentInput.disabled = true;
    }
});

// G·ª≠i b√¨nh lu·∫≠n
document.getElementById('submit-comment').addEventListener('click', async () => {
    const contentEl = document.getElementById('new-comment-content');
    const content = contentEl.value.trim();
    const token = localStorage.getItem('token');

    if (!content) return alert('Vui l√≤ng nh·∫≠p n·ªôi dung b√¨nh lu·∫≠n.');

    if (!token) {
        alert('B·∫°n c·∫ßn ƒëƒÉng nh·∫≠p ƒë·ªÉ g·ª≠i b√¨nh lu·∫≠n.');
        return window.location.href = '/login.html';
    }

    try {
        const res = await fetch('/api/comments', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json',
                'Authorization': `Bearer ${token}`
            },
            body: JSON.stringify({ content, postId })
        });

        const result = await res.json();

        if (!res.ok) {
            return alert('L·ªói: ' + (result.error || 'Kh√¥ng th·ªÉ g·ª≠i b√¨nh lu·∫≠n'));
        }

        // X√≥a √¥ input v√† reload
        contentEl.value = '';
        alert('B√¨nh lu·∫≠n ƒë√£ ƒë∆∞·ª£c g·ª≠i!');
        loadComments();

    } catch (err) {
        console.error('L·ªói g·ª≠i b√¨nh lu·∫≠n:', err);
        alert('L·ªói k·∫øt n·ªëi. Vui l√≤ng th·ª≠ l·∫°i sau.');
    }
});

    </script>
</body>

</html>